import os

configfile: "config.yaml"
ROOT = config["ROOT"]

DATASETS = [ "bbknn_knn", "scanorama_embed", "scanorama_full",
     "seurat_full", "trvae_embed", "harmony_embed" ]
METRICS_DIR = os.path.join(ROOT, "metrics_lisi")
all_metrics = os.path.join(METRICS_DIR, "all.csv")

rule all_metrics:
    input: 
        expand(os.path.join(METRICS_DIR, "{dataset}_metrics.csv"), dataset=DATASETS)
    output:
        all_metrics
    shell:
        "python all_metrics.py -i {METRICS_DIR} -o {all_metrics} "

rule metrics:
    input:
        u = os.path.join(ROOT, "atlases_merged_anno_new.h5ad"),
        i = os.path.join(ROOT, "atlases_integrated", "{method}.h5ad")
    output:
        os.path.join(METRICS_DIR, "{method}_{type}_metrics.csv")
    shell:
        "python metrics.py -u {input.u} -i {input.i} -o {METRICS_DIR} "
        "-b study -l cell_type_union --type {wildcards.type} --organism mouse -v "

